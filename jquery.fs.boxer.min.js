/*
 * Boxer [Formstone Library]
 * @author Ben Plum
 * @version 1.5.1
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(c){function t(a){l.formatter=u;return c(this).on("click.smart-box",c.extend({},l,a||{}),v)}function v(b){b.preventDefault();b.stopPropagation();var d=c(this),f=d.attr("href"),g=f.toLowerCase().split("."),g=g[g.length-1],j="jpeg"==g||"jpg"==g||"gif"==g||"png"==g,e=!j&&"http"==f.substr(0,4),h=!j&&!e&&0<c(f).length;if(1>c("#boxer").length&&(j||e||h)){a={$target:d,gallery:{active:!1},options:b.data};j&&(b=a.$target.attr("rel"),"undefined"!==typeof b&&!1!==b&&(a.gallery.active=!0,a.gallery.rel= b,a.gallery.$items=c("a[rel= "+a.gallery.rel+"]"),a.gallery.index=a.gallery.$items.index(a.$target),a.gallery.total=a.gallery.$items.length-1));b='<div id="boxer-overlay" style="opacity: 0"></div><div id="boxer" class="'+a.options.customClass;e&&(b+=" iframe");h&&(b+=" inline");b+='" style="opacity: 0;';!0===a.options.fixed&&(b+=" position: absolute;");b+='"><span class="boxer-close">Close</span>';b+='<div class="boxer-container" style="opacity: 0; height: '+a.options.height+"px; width: "+a.options.width+ 'px">';b+='<div class="boxer-content">';j&&(b+='<div class="boxer-meta">',a.gallery.active?(b+='<p class="boxer-position"',1>a.gallery.total&&(b+=' style="display: none;"'),b+=">",b+='<span class="current">'+(a.gallery.index+1)+'</span> of <span class="total">'+(a.gallery.total+1)+"</span>",b+="</p>",b+='<div class="boxer-arrow previous">Previous</div>',b+='<div class="boxer-arrow next">Next</div>',b+='<div class="boxer-caption gallery">'):b+='<div class="boxer-caption">',b+=a.options.formatter.apply(c("body"), [a.$target]),b+="</div></div>");b+="</div></div></div>";c("body").append(b);a.$overlay=c("#boxer-overlay");a.$boxer=c("#boxer");a.$container=a.$boxer.find(".boxer-container");a.$content=a.$boxer.find(".boxer-content");a.$meta=a.$boxer.find(".boxer-meta");a.$position=a.$boxer.find(".boxer-position");a.$caption=a.$boxer.find(".boxer-caption");a.$arrows=a.$boxer.find(".boxer-arrow");a.$animatables=c("#boxer-overlay, #boxer");a.padding=2*parseInt(a.$boxer.css("paddingTop"),10);m();n();c(window).on("resize.smart-box", w).on("keydown.smart-box",x);c("body").on("click.smart-box","#boxer-overlay, #boxer .boxer-close",p);if(a.gallery.active)a.$boxer.on("click.smart-box",".boxer-arrow",y);a.$overlay.animate({opacity:0.75},a.options.duration);a.$boxer.animate({opacity:1},a.options.duration,function(){if(j)q(f);else if(e){var b=c('<iframe class="boxer-iframe" src="'+f+'" />');a.$content.append(b);var b=c(window).height()-a.options.margin-a.padding,d=c(window).width()-a.options.margin-a.padding,g=a.$target.data("height"), i=a.$target.data("width");a.contentHeight=void 0!=g?g:b;a.contentWidth=void 0!=i?i:d;a.$content.css({height:a.contentHeight,width:a.contentWidth});k()}else h?(d=c(c(f).html()),a.$content.append(d),b=d.outerHeight(!0),d=d.outerWidth(!0),g=a.$target.data("height"),i=a.$target.data("width"),a.contentHeight=void 0!=g?g:b,a.contentWidth=void 0!=i?i:d,b=void 0!=g?!1:c(window).height()-a.options.margin-a.padding,a.$content.css({width:a.contentWidth}),!1!==b&&a.contentHeight>b&&(a.contentHeight=b,a.$content.css({height:b, overflowY:"scroll"})),k()):c.error("SMART-BOX: '"+f+"' is not valid.")})}}function k(){var b=(c(window).width()-a.contentWidth-a.padding)/2,d=0>=a.options.top?(c(window).height()-a.contentHeight-a.padding)/2+c(window).scrollTop():a.options.top,f=a.$arrows.outerHeight();a.$arrows.css({marginTop:(a.contentHeight-a.metaHeight-f)/2});a.$boxer.animate({left:b,top:d},a.options.duration);a.$container.show().animate({height:a.contentHeight,width:a.contentWidth},a.options.duration,function(){a.$container.animate({opacity:1}, a.options.duration);a.$boxer.find(".boxer-close").animate({opacity:1},a.options.duration)})}function p(b){b.preventDefault();b.stopPropagation();"undefined"!==typeof a.$animatables&&(a.$animatables.animate({opacity:0},a.options.duration,function(){c(this).remove()}),clearTimeout(i),i=null,c(window).off(".smart-box"),c("body").off(".smart-box"),a.gallery.active&&a.$boxer.off(".smart-box"),a={})}function w(){null!==i&&(clearTimeout(i),i=null);i=setTimeout(function(){m()},10)}function m(){var b=(c(window).width()- a.$boxer.width()-a.padding)/2,d=0>=a.options.top?(c(window).height()-a.$boxer.height()-a.padding)/2+c(window).scrollTop():a.options.top;a.$boxer.css({left:b,top:d})}function q(b){a.$image=c("<img />");a.$image.one("load.smart-box",function(){a.originalHeight=a.$image[0].height;a.originalWidth=a.$image[0].width;a.options.retina&&(a.originalHeight/=2,a.originalWidth/=2);a.$content.prepend(a.$image);""==a.$caption.html()?a.$caption.hide():a.$caption.show();r(0)&&k()}).attr("src",b).addClass("boxer-image"); a.$image[0].complete&&a.$image.trigger("load")}function u(a){a=a.attr("title");return""!=a&&void 0!==a?'<p class="caption">'+a+"</p>":""}function r(b){var d=0==b?a.originalHeight:a.$image.outerHeight(),f=0==b?a.originalWidth:a.$image.outerWidth(),g=0==b?0:a.metaHeight,i=c(window).width()-a.options.margin-a.padding,g=c(window).height()-a.options.margin-a.padding-g,e=f,h=d;f>d?(e=i,h=e*(d/f),h>g&&(h=g,e=h*(f/d))):(h=g,e=h*(f/d),e>i&&(e=i,h=e*(d/f)));if(e>f||h>d)e=f,h=d;if(e<a.options.minWidth||h<a.options.minHeight)f< d?(e=a.options.minWidth,h=e*(d/f)):(h=a.options.minHeight,e=h*(f/d));a.$content.css({width:e});a.$meta.css({width:e});a.$image.css({height:h,width:e});a.metaHeight=a.$meta.outerHeight(!0);a.contentWidth=e;a.contentHeight=h+a.metaHeight;return a.contentHeight>g&&2>b?r(b+1):!0}function y(b){b.preventDefault();b.stopPropagation();b=c(this);b.hasClass("disabled")||(a.gallery.index+=b.hasClass("next")?1:-1,a.gallery.index>a.gallery.total&&(a.gallery.index=a.gallery.total),0>a.gallery.index&&(a.gallery.index= 0),a.$container.animate({opacity:0},a.options.duration,function(){a.$image.remove();a.$target=a.gallery.$items.eq(a.gallery.index);a.$caption.html(a.options.formatter.apply(c("body"),[a.$target]));a.$position.find(".current").html(a.gallery.index+1);q(a.$target.attr("href"));n()}))}function n(){a.$arrows.removeClass("disabled");0==a.gallery.index&&a.$arrows.filter(".previous").addClass("disabled");a.gallery.index==a.gallery.total&&a.$arrows.filter(".next").addClass("disabled")}function x(b){a.gallery.active&& (37==b.keyCode||39==b.keyCode)?(b.preventDefault(),b.stopPropagation(),a.$arrows.filter(37==b.keyCode?".previous":".next").trigger("click")):27==b.keyCode&&a.$boxer.find(".boxer-close").trigger("click")}var l={customClass:"",duration:250,fixed:!1,formatter:function(){},height:100,margin:100,minHeight:300,minWidth:300,retina:!1,top:0,width:100},a={},i=null,s={destroy:function(){p(c.Event("click"));return c(this).off(".smart-box")}};c.fn.boxer=function(a){return s[a]?s[a].apply(this,Array.prototype.slice.call(arguments, 1)):"object"===typeof a||!a?t.apply(this,arguments):this}})(jQuery);